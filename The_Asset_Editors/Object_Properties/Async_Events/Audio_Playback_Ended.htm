<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><script type="text/javascript" src="../../../assets/import/jquery-3.6.1.min.js"></script><script type="text/javascript" src="../../../assets/import/layer/layer.js"></script><script type="text/javascript" src="../../../assets/import/pangu.min.js"></script><link rel="stylesheet" type="text/css" href="../../../assets/import/layer/layui_btn.css"><link rel="stylesheet" type="text/css" href="../../../assets/import/layer/layui_col.css"><link rel="stylesheet" type="text/css" href="../../../assets/import/layer/theme/default/layer.css"><link rel="stylesheet" type="text/css" href="../../../assets/import/main.css"><script>let str;removeHtml=function(t){return t=(t=(t=(t=t.replace(/(<([^>]+)>)/gi,"{}")).replace(/\r\n/g,"\n")).replace(/\n/g,"")).replace(/ {2,}/g," ")},retHtml=function(t){return t.match(/(<([^>]+)>)/gi)},setTranslator=function(t,n,a){let e;e=a?t.attr(a):t.html();let l=n[removeHtml(e)];if(null!=l&&l.length){n=retHtml(e);let o=0;n&&n.forEach(function(t,n){var a=l.replace("{"+o+"}",t);l=a===l?l.replace("{}",t):a,o++}),a?t.attr(a,l):t.html(l)}},noTranslationState=function(){return"true"==window.localStorage.getItem("noTranslationState")},noTranslationStateToggle=function(){window.localStorage.setItem("noTranslationState",!noTranslationState())},addNoTranslationStateButton=function(){$(".header").length&&$(".header").append(`
		
		<button style="
			float: right;
			font-size: 16px;
			padding: 4px 12px;
		"
		onclick="
		window.location.replace('gmmt://'+document.location.hash)
		"
		>打开编辑器</button>

		<button style="
			float: right;
			font-size: 16px;
			padding: 4px 12px;
		"
		onclick="
		noTranslationStateToggle();
		location.reload();
    	event.stopPropagation();
		"
		>切换翻译</button>
		`)},removeExtensionFromHash=function(t){return t.replaceAll("#t=","").replaceAll("%2F","/").replaceAll(".htm","")},$(function(){if(addNoTranslationStateButton(),noTranslationState())return!1;$("div.footer a,h4,caption,blockquote").each(function(){setTranslator($(this),json_global)}),$("p,h1,h2,h3,td,li,a,div.dropspotnote,figcaption,.expandtext").each(function(){setTranslator($(this),json)}),$("th,.warning,.important,.optional").each(function(){setTranslator($(this),json_global)}),$(".header").length&&(window.setInterval(function(){$("#toc-panel a:not('isTranslate')").each(function(){$(this).addClass("isTranslate"),setTranslator($(this),json_global)}),$(".GlossDefinitionText:not('isTranslate')").each(function(){$(this).addClass("isTranslate"),setTranslator($(this),json_global)})},250),console.log("成功啦!现在正在疯狂翻译菜单中!")),$(".tooltip").each(function(){setTranslator($(this),json_global,"title")})}),document.addEventListener("DOMContentLoaded",()=>{pangu.autoSpacingPage()})</script><script type="text/javascript" language="JavaScript">function reDo(){innerWidth==origWidth&&innerHeight==origHeight||location.reload()}4==parseInt(navigator.appVersion)&&"Netscape"==navigator.appName&&(origWidth=innerWidth,origHeight=innerHeight,onresize=reDo),onerror=null</script><style type="text/css">p.WebHelpNavBar{text-align:right}</style><script type="text/javascript">gCommonRootRelPath=gRootRelPath="../../..",gTopicId="6.3.1.2.0_2"</script><script type="text/javascript" src="../../../template/scripts/rh.min.js"></script><script type="text/javascript" src="../../../template/scripts/common.min.js"></script><script type="text/javascript" src="../../../template/scripts/topic.min.js"></script><script type="text/javascript" src="../../../template/scripts/topicwidgets.min.js"></script><script type="text/javascript" src="../../../whxdata/projectsettings.js"></script><link rel="stylesheet" type="text/css" href="../../../template/styles/topic.min.css"><link rel="stylesheet" type="text/css" href="../../../template/Charcoal_Grey/topicheader.css"><meta name="topic-status" content="Draft"><link rel="stylesheet" type="text/css" href="../../../assets/css/default.css"><script src="../../../../assets/scripts/main_script.js"></script><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="generator" content="Adobe RoboHelp 2022"><title>Audio Playback Ended</title><meta name="topic-status" content="Draft"><link rel="stylesheet" type="text/css" href="../../../assets/css/default.css"><meta name="rh-authors" content="Bart Teunis"><meta name="topic-comment" content="Reference page for the async Audio Playback Ended event"><meta name="template" content="../../../assets/masterpages/Manual_Page.htt"><meta name="search-keywords" content="Audio Playback Ended,ev_async_audio_playback_ended"><meta name="rh-index-keywords" content="Objects - Async Audio Playback Ended Event"><meta name="brsnext" value="The_Asset_Editors/Object_Properties/Async_Events/Audio_Recording.htm"><meta name="brsprev" value="The_Asset_Editors/Object_Properties/Async_Events/Audio_Playback.htm"></head><body><div class="topic-header rh-hide" id="rh-topic-header"><div class="logo"></div><div class="nav"><div class="title" title="Audio Playback Ended"><span>Audio Playback Ended</span></div><div class="gotohome" title="Click here to see this page in full context"><a href="#" onclick="rh._.goToFullLayout()">Click here to see this page in full context</a></div></div></div><div class="topic-header-shadow rh-hide" id="rh-topic-header-shadow"></div><div></div><div><h1><span data-field="title" data-format="default">Audio Playback Ended</span></h1><p><img class="center" src="../../../assets/Images/Asset_Editors/Async_AudioPlaybackEnded.png" style="cursor:nesw-resize">This event is triggered whenever playback ends for a sound instance played using the <span class="inline2">audio_play_sound_</span> functions.</p><p>Playback&nbsp;of a&nbsp;sound ends in the following situations:&nbsp;</p><ul class="colour"><li>The sound <strong>reaches its end position</strong>. Pausing a sound using <span class="inline3_func"><a href="../../../GameMaker_Language/GML_Reference/Asset_Management/Audio/audio_pause_sound.htm">audio_pause_sound</a></span>, changing its track position using&nbsp;<span class="inline3_func"><a href="../../../GameMaker_Language/GML_Reference/Asset_Management/Audio/audio_sound_set_track_position.htm">audio_sound_set_track_position</a></span>&nbsp;or looping a section of it by changing the&nbsp;<a href="../../../GameMaker_Language/GML_Reference/Asset_Management/Audio/Audio_Loop_Points/Audio_Loop_Points.htm">Audio Loop Points</a>&nbsp;postpones the end of playback as the sound doesn't reach the end position this way.</li><li>The sound is <strong>stopped</strong>, through a call to&nbsp;<span class="inline3_func"><a href="../../../GameMaker_Language/GML_Reference/Asset_Management/Audio/audio_stop_sound.htm">audio_stop_sound</a></span>&nbsp;or&nbsp;<span class="inline3_func"><a href="../../../GameMaker_Language/GML_Reference/Asset_Management/Audio/audio_stop_all.htm">audio_stop_all</a></span>. I.e. stopping a sound also <em>always</em> means it ends playback.</li><li>The sound is <strong>forced to stop</strong> due to <em>voice stealing</em>: when another sound is played using any&nbsp;of the <span class="inline2">audio_play_sound_</span> functions&nbsp;and all channels are used (see&nbsp;<span class="inline3_func"><a href="../../../GameMaker_Language/GML_Reference/Asset_Management/Audio/audio_channel_num.htm">audio_channel_num</a></span>), a channel playing a sound with a lower priority than the new&nbsp;one will be used to play the new sound, i.e. the channel is <em>stolen</em>&nbsp;by the new sound. An&nbsp;<span data-field="title" data-format="default">Audio Playback Ended</span>&nbsp;event is triggered for the sound that was forced to stop playing.</li></ul><p>The event will trigger in all objects that have it, for any sound played in the game (even when it's not played by the same object).</p><p>The event returns information in&nbsp;the&nbsp;<span class="inline2"><a href="../../../GameMaker_Language/GML_Overview/Variables/Builtin_Global_Variables/async_load.htm">async_load</a></span>&nbsp;ds_map. The map contains the following keys in case of an&nbsp;<span data-field="title" data-format="default">Audio Playback Ended</span>&nbsp;event:&nbsp;</p><ul class="colour"><li><strong>"sound_id"</strong> - the&nbsp;<span data-keyref="Type_ID_Sound_Instance"><a target="_blank" href="../../../GameMaker_Language/GML_Reference/Asset_Management/Audio/audio_play_sound.htm">Sound Instance ID</a></span> that ended playback.</li><li><strong>"asset_id"</strong> - the index of the&nbsp;<span data-keyref="Type_Asset_Sound"><a target="_blank" href="../../Sounds.htm">Sound Asset</a></span>.</li><li><strong>"was_stopped"</strong> - this is set to <span class="inline2">false</span>, unless the sound was stopped manually using the <span class="inline2">audio_stop_</span> functions or when it was forced to stop playing.</li></ul><p class="note"><span data-conref="../../../assets/snippets/Tag_note.hts"><span class="note">NOTE</span></span>&nbsp;<em>Pausing</em> a sound does <em>not</em> end playback, as playback can still be <em>resumed</em>&nbsp;afterwards.</p><h2>Example</h2><p>Suppose you play a sound using any of the <span class="inline2">audio_play_sound_</span> functions:&nbsp;</p><p class="code">ins_snd_bgm = audio_play_sound(snd_music, 100, false);</p><p>If you call no&nbsp;other sound functions&nbsp;on this sound, it will&nbsp;play until the end. At that point, the&nbsp;<span data-field="title" data-format="default">Audio Playback Ended</span>&nbsp;event is triggered for the sound. The&nbsp;<span class="inline2"><a href="../../../GameMaker_Language/GML_Overview/Variables/Builtin_Global_Variables/async_load.htm">async_load</a></span>&nbsp;ds_map will contain the following values in that case:&nbsp;</p><ul class="colour"><li><strong>"sound_id"</strong> - the sound ID returned by&nbsp;<span class="inline3_func"><a href="../../../GameMaker_Language/GML_Reference/Asset_Management/Audio/audio_play_sound.htm">audio_play_sound</a></span> and stored in&nbsp;<span class="inline2">ins_snd_bgm</span></li><li><strong>"asset_id"</strong> -&nbsp;<span class="inline2">snd_music</span></li><li><strong>"was_stopped"</strong> -&nbsp;<span class="inline2">false</span>&nbsp;(the sound wasn't stopped <em>or</em> forced to stop)</li></ul><p>If you stop the sound before it reaches its end, the <span data-field="title" data-format="default">Audio Playback Ended</span>&nbsp;event is triggered as well. This can be done using any of the following lines of code:&nbsp;</p><p class="code">// Stop the sound instance<br>audio_stop_sound(ins_snd_bgm);<br><br>// Stop all instances of the sound asset<br>audio_stop_sound(snd_relaxed);<br><br>// Stop all sounds that are playing<br>audio_stop_all();</p><p>In this case, the sound was stopped through a call to one of the <span class="inline2">audio_stop_</span> functions, so instead&nbsp;of being <span class="inline2">false</span>,&nbsp;<span class="inline2">"was_stopped"</span> will be <span class="inline2">true</span>&nbsp;here.</p><p>Finally, if you start playing additional sounds with a higher priority while this sound is playing, these will also take up a channel (or a <em>voice</em>). If no free channels are left then <span class="inline2">ins_snd_bgm</span>&nbsp;may be forced to stop and the&nbsp;<span data-field="title" data-format="default">Audio Playback Ended</span>&nbsp;event is triggered. In this case, <span class="inline2">"was_stopped"</span> is also set to <span class="inline2">true</span>.</p><p>&nbsp;</p><p>&nbsp;</p><div class="footer"><div class="buttons"><div class="clear"><div>Back:&nbsp;<a href="../Async_Events.htm">Async Events</a></div><div>Next:&nbsp;<a href="Audio_Recording.htm">Audio Recording</a></div></div></div><h5><span data-keyref="Copyright Notice">© Copyright YoYo Games Ltd. 2024 All Rights Reserved</span></h5></div></div></body></html>
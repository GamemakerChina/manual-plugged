<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><script type="text/javascript" src="../../../../assets/import/jquery-3.6.1.min.js"></script><script type="text/javascript" src="../../../../assets/import/layer/layer.js"></script><script type="text/javascript" src="../../../../assets/import/pangu.min.js"></script><link rel="stylesheet" type="text/css" href="../../../../assets/import/layer/layui_btn.css"><link rel="stylesheet" type="text/css" href="../../../../assets/import/layer/layui_col.css"><link rel="stylesheet" type="text/css" href="../../../../assets/import/layer/theme/default/layer.css"><link rel="stylesheet" type="text/css" href="../../../../assets/import/main.css"><script>let str;removeHtml=function(e){return e=(e=(e=(e=e.replace(/(<([^>]+)>)/gi,"{}")).replace(/\r\n/g,"\n")).replace(/\n/g,"")).replace(/ {2,}/g," ")},retHtml=function(e){return e.match(/(<([^>]+)>)/gi)},setTranslator=function(e,t,n){let i;i=n?e.attr(n):e.html();let o=t[removeHtml(i)];if(null!=o&&o.length){t=retHtml(i);let a=0;t&&t.forEach(function(e,t){var n=o.replace("{"+a+"}",e);o=n===o?o.replace("{}",e):n,a++}),n?e.attr(n,o):e.html(o)}},noTranslationState=function(){return"true"==window.localStorage.getItem("noTranslationState")},noTranslationStateToggle=function(){window.localStorage.setItem("noTranslationState",!noTranslationState())},addNoTranslationStateButton=function(){var e=`
		
		<button style="
			float: right;
			font-size: 16px;
			padding: 4px 12px;
		"
		onclick="
		window.location.replace('gmmt://'+document.location.hash)
		"
		>打开编辑器</button>

		<button style="
			float: right;
			font-size: 16px;
			padding: 4px 12px;
		"
		onclick="
		noTranslationStateToggle();
		location.reload();
    	event.stopPropagation();
		"
		>切换翻译</button>
		`;$(".header").length?$(".header").append(e):($(".topic-header").append(e),$(".topic-header button").css("position","relative").css("top","44px"))},removeExtensionFromHash=function(e){return e.replaceAll("#t=","").replaceAll("%2F","/").replaceAll(".htm","")};let json_global,json_file={"A DS&nbsp;map with the information to encode (or an array)":"带有要编码的信息(或数组)的 DS 映射",'A collection of name/value pairs, called a {}{}DS Map{}{} in {}GameMaker{} but also known as a "dictionary" or "object" in other programming languages.':'名称/值对的集合，在{4} GameMaker {5}中称为{}{} DS Map {}{} ，但在其他编程语言中也称为“字典”或“对象”("dictionary" or "object")。','An ordered list of values, called a {}{}DS {}{}List{}{} in {}GameMaker{} but this can also be called an "array" or "sequence" in other programming languages.':'一个有序的值列表，在{6} GameMaker {7}中称为{}{} DS {}{} List {} {}，但在其他编程语言中也可以称为“数组”或“序列”("array" or "sequence")。','If the provided map contains any circular references, such as references back to the main map itself (forming an infinite loop) or references to maps within the main map forming such infinite loops, such references will be serialised only on the first level where they\'re encountered, and converted to {}"null"{}&nbsp;for deeper references.':'如果提供的 map 包含任何循环引用，例如返回到主 map 本身的引用 (形成无限循环) 或对主 map 内的 map 的引用形成这种无限循环，则这些引用将仅在遇到它们的第一级上被序列化，并转换为 {}"null"{} 以用于更深的引用。','If you encode an int64 to JSON it will write it as an {}int{} if it is in the valid range for an int32, as a {}double{} if it can do so without losing precision or (if neither of those cases is applicable) as a {}string{} with an identifier "{}@i64@{}" before it and "{}$i64${}" after it. When you come to decode the JSON to a map again {}GameMaker{} will pick these identifiers up and re-convert the value to an int64. This does mean that if the JSON is intended for a server or some other non-GameMaker target, these values will not be appropriate and so should be avoided.':"如果您将 int64 编码为 JSON，如果它在 int32 的有效范围内，它会将其写为 {}int{}，如果它可以在不丢失精度的情况下写为 {}double{}，或者(如果 这些情况都不适用)作为{}字符串{}，其前面有标识符“{}@i64@{}”，后面有“{}$i64${}”。 当您再次将 JSON 解码为 map 时，{}GameMaker{} 将选取这些标识符并将值重新转换为 int64。 这确实意味着如果 JSON 用于服务器或其他一些非 GameMaker 目标，则这些值将不合适，因此应避免使用。","JSON (JavaScript Object Notation) is a lightweight data-interchange format which is easy for to read and write, for both people and machines. It is built on two basic structures:":"JSON (JSON)是一种轻量级的数据交换格式，对于人和机器来说，都很容易读写。它建立在两个基本结构之上:","Note that care should be taken when writing JSON to an ini file, as the ini specifications can cause issues when using quotes and escape characters. See the function {}{}ini_write_string(){}{} for more information.":"请注意，将 JSON 写入 ini 文件时应小心，因为 ini 规范在使用引号和转义字符时可能会导致问题。 有关详细信息，请参阅函数 {}{}ini_write_string(){}{}。",'Note that care should be taken when writing JSON to an ini file, as the ini specifications can cause issues when using quotes and escape characters. See the function {}{}ini_write_string(){}{} for more information. Also note that if you encode an int64 to JSON it will write it as an {}int{} if it is in the valid range for an int32, as a {}double{} if it can do so without losing precision or (if neither of those cases is applicable) as a {}string{} with an identifier "{}@i64@{}" before it and "{}$i64${}" after it. When you come to decode the JSON to a map again {}GameMaker{} will pick these identifiers up and re-convert the value to an int64. This does mean that if the JSON is intended for a server or some other non-GameMaker target, these values will not be appropriate and so should be avoided.':"请注意，将 JSON 写入 ini 文件时应小心，因为 ini 规范在使用引号和转义字符时可能会导致问题。 有关详细信息，请参阅函数 {}{}ini_write_string(){}{}。 另请注意，如果您将 int64 编码为 JSON，如果它在 int32 的有效范围内，它会将其写为 {}int{}，如果它可以在不丢失精度的情况下写为 {}double{}，或者(如果 这些情况都不适用)作为{}字符串{}，其前面有标识符“{}@i64@{}”，后面有“{}$i64${}”。 当您再次将 JSON 解码为 map 时，{}GameMaker{} 将选取这些标识符并将值重新转换为 int64。 这确实意味着如果 JSON 用于服务器或其他一些非 GameMaker 目标，则这些值将不合适，因此应避免使用。",'The above code creates a DS map and then loops through the name and score arrays, adding each key/value pair to the new map. Next, this map is encoded using {}json_encode(){} and stored as a string in the variable "str". This string is then sent to a web server using {}http_post_string(){} and the DS&nbsp;map is destroyed to prevent a memory leak as it is no-longer needed.':"上面的代码创建了一个 DS 映射，然后遍历 name 和 score 数组，将每个键/值对添加到新映射中。 接下来，使用 {}json_encode(){} 对该 map 进行编码，并将其作为字符串存储在变量“str”中。 然后使用 {}http_post_string(){} 将此字符串发送到网络服务器，并销毁 DS map 以防止内存泄漏，因为不再需要它。","When using this function there are some important things to note:":"使用此函数时，需要注意一些重要事项：","{}IMPORTANT!{}&nbsp;JSON is agnostic about numbers. In any programming language, there can be a variety of number types of various capacities and complements, fixed or floating, binary or decimal. That can make interchange between different programming languages difficult. JSON instead offers only the representation of numbers that humans use: a sequence of digits. All programming languages know how to make sense of digit sequences even if they disagree on internal representations. For more information see the {}ECMA JSON Standard{}.":"{}重要{}JSON 与数字无关。 在任何编程语言中，都可以有各种容量和补码的多种数字类型，固定的或浮动的，二进制的或十进制的。 这会使不同编程语言之间的交流变得困难。 相反，JSON 仅提供人类使用的数字表示：数字序列。 所有编程语言都知道如何理解数字序列，即使它们在内部表示上存在分歧。 如需了解详细信息，请参阅 {}ECMA JSON 标准{}。","{}IMPORTANT!{}&nbsp;This function -&nbsp;while still valid -&nbsp;has been superseded by the function {}{}json_stringify(){}{}, and we recommend that you only use this function for legacy support.":"{}重要{} 此函数 -虽然仍然有效 -已被函数 {}{}json_stringify(){}{} 取代，我们仅建议您将此函数用于旧版支持。","{}NOTE{}: The hierarchical functionality of JSON is available through special DS map&nbsp;and DS list functions (for example {}{}ds_map_add_list(){}{}&nbsp;or {}{}ds_list_mark_as_map(){}{}), so you are able to encode sub-lists and maps.":"{}注意{}：JSON 的分层函数可通过特殊的 DS 映射和 DS 列表函数(例如 {}{}ds_map_add_list(){}{}或 {}{}ds_list_mark_as_map(){}{} )，因此您可以对子列表和映射进行编码。","{}json_encode(){}&nbsp;takes a DS map or array that you have previously created and encodes it as a JSON string which you can then use as (for example) part of an {}{}http_post_string(){}{} call, or - so it can be stored externally - it can be written to a file. If using an array as the top level structure, then the array can only contain valid values or other arrays, and&nbsp;{}not{}&nbsp;data structures. For that you should use the appropriate DS functions.":"{}json_encode(){}获取您之前创建的 DS 映射或数组并将其编码为 JSON 字符串，然后您可以将其用作(例如){}{}http_post_string(){}{}的一部分 调用，或者 - 所以它可以存储在外部 - 它可以写入文件。 如果使用数组作为顶级结构，则该数组只能包含有效值或其他数组，并且{}不是{}数据结构。 为此，您应该使用适当的 DS 函数。",'{}{}infinity{}{} and {}{}NaN{}{} will be written into the JSON as {}"@@infinity$"{} ({}"@@-infinity$"{} for negative) and {}"@@nan$"{} respectively. These values will be correctly loaded back into memory when the JSON is loaded with {}{}json_decode{}{}.':'{}{}infinity{}{} 和 {}{}NaN{}{} 将分别作为 {}"@@infinity$"{}({}"@@-infinity$"{} 表示负数) 和 {}"@@nan$"{} 写入 JSON。当使用 {}{}json_decode{}{} 加载 JSON 时，这些值将正确加载回内存。'},get_json_global=$.ajax({url:"/global.json",type:"GET",dataType:"json",async:!1,success:function(e){json_global=e}});$(function(){if(addNoTranslationStateButton(),noTranslationState())return!1;$("div.footer a,h4,caption").each(function(){setTranslator($(this),json_global)}),$("p,h1,h2,h3,td,li,a,div.dropspotnote,figcaption").each(function(){setTranslator($(this),json_file)}),$("th,.warning,.important,.optional").each(function(){setTranslator($(this),json_global)}),$(".header").length&&(window.setInterval(function(){$("#toc-panel a:not('isTranslate')").each(function(){$(this).addClass("isTranslate"),setTranslator($(this),json_global)}),$(".GlossDefinitionText:not('isTranslate')").each(function(){$(this).addClass("isTranslate"),setTranslator($(this),json_global)})},250),console.log("成功啦!现在正在疯狂翻译菜单中!")),$(".tooltip").each(function(){setTranslator($(this),json_global,"title")})}),document.addEventListener("DOMContentLoaded",()=>{pangu.autoSpacingPage()})</script><script type="text/javascript" language="JavaScript">function reDo(){innerWidth==origWidth&&innerHeight==origHeight||location.reload()}4==parseInt(navigator.appVersion)&&"Netscape"==navigator.appName&&(origWidth=innerWidth,origHeight=innerHeight,onresize=reDo),onerror=null</script><style type="text/css">p.WebHelpNavBar{text-align:right}</style><script type="text/javascript">gCommonRootRelPath=gRootRelPath="../../../..",gTopicId="8.2.2.17.6.0_1"</script><script type="text/javascript" src="../../../../template/scripts/rh.min.js"></script><script type="text/javascript" src="../../../../template/scripts/common.min.js"></script><script type="text/javascript" src="../../../../template/scripts/topic.min.js"></script><script type="text/javascript" src="../../../../template/scripts/topicwidgets.min.js"></script><script type="text/javascript" src="../../../../whxdata/projectsettings.js"></script><link rel="stylesheet" type="text/css" href="../../../../template/styles/topic.min.css"><link rel="stylesheet" type="text/css" href="../../../../template/Charcoal_Grey/topicheader.css"><meta name="topic-status" content="Draft"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>json_encode</title><meta name="generator" content="Adobe RoboHelp 2022"><link rel="stylesheet" href="../../../../assets/css/default.css" type="text/css"><script src="../../../../assets/scripts/main_script.js" type="module"></script><meta name="rh-authors" content="Mark Alexander"><meta name="topic-comment" content="Reference page for json_encode"><meta name="rh-index-keywords" content="json_encode"><meta name="search-keywords" content="json_encode"><meta name="is_pure" content="true"><meta name="brsnext" value="GameMaker_Language/GML_Reference/File_Handling/Encoding_And_Hashing/json_decode.htm"><meta name="brsprev" value="GameMaker_Language/GML_Reference/File_Handling/Encoding_And_Hashing/Encoding_And_Hashing.htm"></head><body><div class="topic-header rh-hide" id="rh-topic-header"><div class="logo"></div><div class="nav"><div class="title" title="json_encode"><span>json_encode</span></div><div class="gotohome" title="Click here to see this page in full context"><a href="#" onclick="rh._.goToFullLayout()">Click here to see this page in full context</a></div></div></div><div class="topic-header-shadow rh-hide" id="rh-topic-header-shadow"></div><h1><span data-field="title" data-format="default">json_encode</span></h1><p>This function takes an existing&nbsp;<span data-keyref="Type_ID_DS_Map"><a target="_blank" href="../../Data_Structures/DS_Maps/ds_map_create.htm">DS Map</a></span>&nbsp;and encodes it as a JSON string.&nbsp;The JSON string can be used,&nbsp;e.g., as part of an&nbsp;<span class="inline3_func"><a href="../../Asynchronous_Functions/HTTP/http_post_string.htm">http_post_string</a></span> call or&nbsp;be written to a file,&nbsp;so the data can be stored externally.</p><p class="note"><span data-conref="../../../../assets/snippets/Tag_important.hts"><span class="important">IMPORTANT</span></span>&nbsp;This function -&nbsp;while still valid -&nbsp;has been superseded by the function <span class="inline3_func"><a href="json_stringify.htm">json_stringify</a></span>, and we recommend that you only use this function for legacy support.</p><p>The DS map can contain the following:&nbsp;</p><ul class="colour"><li>Nested&nbsp;<a href="../../Data_Structures/DS_Maps/DS_Maps.htm">DS Maps</a>&nbsp;and&nbsp;<a href="../../Data_Structures/DS_Lists/DS_Lists.htm">DS Lists</a>&nbsp;that should be marked correctly using the&nbsp;DS map&nbsp;<a href="../../Data_Structures/DS_Maps/DS_Maps.htm#func_ref_json">JSON</a>&nbsp;functions and the&nbsp;DS list&nbsp;<a href="../../Data_Structures/DS_Lists/DS_Lists.htm#func_ref_json">JSON</a> functions respectively.</li><li>Nested&nbsp;<a href="../../../GML_Overview/Structs.htm">Structs</a>&nbsp;and&nbsp;<a href="../../../GML_Overview/Arrays.htm">Arrays</a>&nbsp;which are written as nested&nbsp;JSON&nbsp;objects and arrays respectively.</li></ul><h3>Usage Notes</h3><ul class="colour"><li><span data-keyref="GameMaker Name">GameMaker</span>&nbsp;encodes certain values in the JSON as a string so they can be read back correctly later.&nbsp;See&nbsp;<a href="../../../../Additional_Information/Guide_To_Using_JSON.htm#data_conversions">Data Conversions</a>&nbsp;for an overview of these conversions.</li></ul><div data-conref="../../../../assets/snippets/Note_See_Guide_To_Using_JSON.hts"><p class="note"><span data-conref="../../../../assets/snippets/Tag_note.hts"><span class="note">NOTE</span></span>&nbsp;See&nbsp;<a href="../../../../Additional_Information/Guide_To_Using_JSON.htm">Guide To Using JSON</a>&nbsp;for detailed information on how to work with JSON in&nbsp;<span data-keyref="GameMaker Name">GameMaker</span>.</p></div><h4>Syntax:</h4><p class="code"><span data-field="title" data-format="default">json_encode</span>(map, [prettify])</p><table><tbody><tr><th>Argument</th><th>Type</th><th>Description</th></tr><tr><td>map</td><td><span data-keyref="Type_ID_DS_Map"><a target="_blank" href="../../Data_Structures/DS_Maps/ds_map_create.htm">DS Map</a></span></td><td>A DS&nbsp;map with the information to encode</td></tr><tr><td>prettify</td><td><span data-keyref="Type_Bool"><a target="_blank" href="../../../GML_Overview/Data_Types.htm">Boolean</a></span></td><td><span data-conref="../../../../assets/snippets/Tag_optional.hts"><span class="optional">OPTIONAL</span></span>&nbsp;Whether to prettify the output,&nbsp;i.e. insert indentation and line breaks for readability</td></tr></tbody></table><p>&nbsp;</p><h4>Returns:</h4><p class="code"><span data-keyref="Type_String"><a target="_blank" href="../../../GML_Overview/Data_Types.htm">String</a></span></p><p>&nbsp;</p><h4>Example 1: Basic Use</h4><p class="code">var _hiscore_map, _json;<br>_hiscore_map = ds_map_create();<br>for (var i = 0; i &lt; 10; i ++;)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;ds_map_add(_hiscore_map, name[i], score[i]);<br>}<br>_json&nbsp;= json_encode(_hiscore_map);<br>ds_map_destroy(_hiscore_map);<br><br>post_request_id = http_post_string($"http://www.angusgames.com/game?game_id={global.game_id}", _json);</p><p>The above code creates a <span data-keyref="Type_ID_DS_Map"><a target="_blank" href="../../Data_Structures/DS_Maps/ds_map_create.htm">DS Map</a></span>&nbsp;and then loops through the <span class="inline2">name</span> and <span class="inline2">score</span> arrays, adding each key/value pair to the new map. Next, this map is encoded using&nbsp;<span class="inline3_func"><a href="json_encode.htm">json_encode</a></span> and stored as a string in the variable <span class="inline2">_str</span>. This string is then sent to a web server using&nbsp;<span class="inline3_func"><a href="../../Asynchronous_Functions/HTTP/http_post_string.htm">http_post_string</a></span> and the DS&nbsp;map is destroyed to prevent a memory leak as it is no longer needed.</p><p>&nbsp;</p><h4>Example 2: Hierarchy of Mixed Data Types</h4><p class="code">var _map = ds_map_create();<br>var _list = ds_list_create();<br><br>ds_map_add_list(_map, "seasoning", _list);<br>ds_list_add(_list, "pepper", "salt", "thyme");<br><br>_map[? "greeting"] = {parts: ["Hello", "World!"], separator: ", "};<br>_map[? "food"] = ["bread", "coconut", "mango"];<br><br>var _json = json_encode(_map, true);<br>// ds_map_destroy(_map);<br><br>show_debug_message(_json);</p><p>The code example above shows how to encode a DS map with mixed contents to JSON.</p><p>First, a DS map and a DS list are created and stored in temporary variables. The DS list is then added to the DS map using&nbsp;<span class="inline3_func"><a href="../../Data_Structures/DS_Maps/ds_map_add_list.htm">ds_map_add_list</a></span>&nbsp;and gets a few items added to it with a call to&nbsp;<span class="inline3_func"><a href="../../Data_Structures/DS_Lists/ds_list_add.htm">ds_list_add</a></span>. After that, two other keys are added to the map, one gets assigned a&nbsp;<span data-keyref="Type_Struct"><a target="_blank" href="../../../GML_Overview/Structs.htm">Struct</a></span>&nbsp;as the value with an&nbsp;<span data-keyref="Type_Array"><a target="_blank" href="../../../GML_Overview/Arrays.htm">Array</a></span>&nbsp;in it, the other gets assigned an array.</p><p>The map's contents are then encoded with a call&nbsp;<span class="inline3_func"><span data-field="title" data-format="default">json_encode</span></span>, with the <span class="inline2">prettify</span> parameter set to <span class="inline2">true</span>. If you only need the JSON string, the map can be destroyed right after this.</p><p>Finally, the JSON string is shown in a debug message.</p><p>&nbsp;</p><p>&nbsp;</p><div class="footer"><div class="buttons"><div class="clear"><div style="float:left">Back:&nbsp;<a href="Encoding_And_Hashing.htm">Encoding And Hashing</a></div><div style="float:right">Next:&nbsp;<a href="json_encode.htm">json_encode</a></div></div></div><h5><span data-keyref="Copyright Notice">© Copyright YoYo Games Ltd. 2024 All Rights Reserved</span></h5></div></body></html>
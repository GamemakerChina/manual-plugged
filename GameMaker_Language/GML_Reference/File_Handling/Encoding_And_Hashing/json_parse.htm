<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><script type="text/javascript" src="../../../../assets/import/jquery-3.6.1.min.js"></script><script type="text/javascript" src="../../../../assets/import/layer/layer.js"></script><script type="text/javascript" src="../../../../assets/import/pangu.min.js"></script><link rel="stylesheet" type="text/css" href="../../../../assets/import/layer/layui_btn.css"><link rel="stylesheet" type="text/css" href="../../../../assets/import/layer/layui_col.css"><link rel="stylesheet" type="text/css" href="../../../../assets/import/layer/theme/default/layer.css"><link rel="stylesheet" type="text/css" href="../../../../assets/import/main.css"><script>let str;removeHtml=function(t){return t=(t=(t=(t=t.replace(/(<([^>]+)>)/gi,"{}")).replace(/\r\n/g,"\n")).replace(/\n/g,"")).replace(/ {2,}/g," ")},retHtml=function(t){return t.match(/(<([^>]+)>)/gi)},setTranslator=function(t,n,a){let e;e=a?t.attr(a):t.html();let l=n[removeHtml(e)];if(null!=l&&l.length){n=retHtml(e);let o=0;n&&n.forEach(function(t,n){var a=l.replace("{"+o+"}",t);l=a===l?l.replace("{}",t):a,o++}),a?t.attr(a,l):t.html(l)}},noTranslationState=function(){return"true"==window.localStorage.getItem("noTranslationState")},noTranslationStateToggle=function(){window.localStorage.setItem("noTranslationState",!noTranslationState())},addNoTranslationStateButton=function(){$(".header").length&&$(".header").append(`
		
		<button style="
			float: right;
			font-size: 16px;
			padding: 4px 12px;
		"
		onclick="
		window.location.replace('gmmt://'+document.location.hash)
		"
		>打开编辑器</button>

		<button style="
			float: right;
			font-size: 16px;
			padding: 4px 12px;
		"
		onclick="
		noTranslationStateToggle();
		location.reload();
    	event.stopPropagation();
		"
		>切换翻译</button>
		`)},removeExtensionFromHash=function(t){return t.replaceAll("#t=","").replaceAll("%2F","/").replaceAll(".htm","")},$(function(){if(addNoTranslationStateButton(),noTranslationState())return!1;$("div.footer a,h4,caption,blockquote").each(function(){setTranslator($(this),json_global)}),$("p,h1,h2,h3,td,li,a,div.dropspotnote,figcaption,.expandtext").each(function(){setTranslator($(this),json)}),$("th,.warning,.important,.optional").each(function(){setTranslator($(this),json_global)}),$(".header").length&&(window.setInterval(function(){$("#toc-panel a:not('isTranslate')").each(function(){$(this).addClass("isTranslate"),setTranslator($(this),json_global)}),$(".GlossDefinitionText:not('isTranslate')").each(function(){$(this).addClass("isTranslate"),setTranslator($(this),json_global)})},250),console.log("成功啦!现在正在疯狂翻译菜单中!")),$(".tooltip").each(function(){setTranslator($(this),json_global,"title")})}),document.addEventListener("DOMContentLoaded",()=>{pangu.autoSpacingPage()})</script><script type="text/javascript" language="JavaScript">function reDo(){innerWidth==origWidth&&innerHeight==origHeight||location.reload()}4==parseInt(navigator.appVersion)&&"Netscape"==navigator.appName&&(origWidth=innerWidth,origHeight=innerHeight,onresize=reDo),onerror=null</script><style type="text/css">p.WebHelpNavBar{text-align:right}</style><script type="text/javascript">gCommonRootRelPath=gRootRelPath="../../../..",gTopicId="8.2.2.17.6.0_4"</script><script type="text/javascript" src="../../../../template/scripts/rh.min.js"></script><script type="text/javascript" src="../../../../template/scripts/common.min.js"></script><script type="text/javascript" src="../../../../template/scripts/topic.min.js"></script><script type="text/javascript" src="../../../../template/scripts/topicwidgets.min.js"></script><script type="text/javascript" src="../../../../whxdata/projectsettings.js"></script><link rel="stylesheet" type="text/css" href="../../../../template/styles/topic.min.css"><link rel="stylesheet" type="text/css" href="../../../../template/Charcoal_Grey/topicheader.css"><meta name="topic-status" content="Draft"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>json_parse</title><meta name="generator" content="Adobe RoboHelp 2022"><link rel="stylesheet" href="../../../../assets/css/default.css" type="text/css"><script src="../../../../assets/scripts/main_script.js" type="module"></script><meta name="rh-authors" content="Mark Alexander"><meta name="topic-comment" content="Reference page for json_parse"><meta name="rh-index-keywords" content="json_parse"><meta name="search-keywords" content="json_parse"><meta name="is_pure" content="true"><meta name="brsnext" value="GameMaker_Language/GML_Reference/File_Handling/Encoding_And_Hashing/base64_encode.htm"><meta name="brsprev" value="GameMaker_Language/GML_Reference/File_Handling/Encoding_And_Hashing/json_stringify.htm"></head><body><div class="topic-header rh-hide" id="rh-topic-header"><div class="logo"></div><div class="nav"><div class="title" title="json_parse"><span>json_parse</span></div><div class="gotohome" title="Click here to see this page in full context"><a href="#" onclick="rh._.goToFullLayout()">Click here to see this page in full context</a></div></div></div><div class="topic-header-shadow rh-hide" id="rh-topic-header-shadow"></div><h1><span data-field="title" data-format="default">json_parse</span></h1><p>This function parses a JSON string and converts it into a collection of nested arrays and structs.&nbsp;An array is the equivalent of a JSON array and a struct is the equivalent of a JSON object.</p><p>The JSON should be either previously created using&nbsp;<span class="inline3_func"><a href="json_stringify.htm">json_stringify</a></span>&nbsp;or should come from any other valid source.</p><p>You supply the string to parse, and the function will return the top-level array or struct which can then be used in your code. If you are not sure of the contents of the JSON, you can use the different&nbsp;<a href="../../Variable_Functions/Variable_Functions.htm">Variable Functions</a>&nbsp;(like&nbsp;<span class="inline3_func"><a href="../../Variable_Functions/typeof.htm">typeof</a></span> and&nbsp;<span class="inline3_func"><a href="../../Variable_Functions/variable_struct_get_names.htm">struct_get_names</a></span> in case of a struct) to check the returned contents.</p><h3>Usage Notes</h3><ul class="colour"><li>Trying to parse an&nbsp;invalid value&nbsp;(i.e.: not a string, or invalid JSON) will throw an exception error.</li><li>This function only allows you to load JSON files with a maximum nesting limit of <span data-keyref="Const_JSON_Max_Nesting_Limit">128</span>.</li><li>Data conversions:<ul><li><span class="inline2">null</span> values are parsed as <span class="inline2">undefined</span>.</li><li>Any runtime values serialised by&nbsp;<span class="inline3_func"><a href="json_stringify.htm">json_stringify</a></span>&nbsp;will be converted back to runtime values (e.g. <a href="../../../GML_Overview/Data_Types.htm">handles</a> and values like <span class="inline2">int64</span>, <span class="inline2">NaN</span> and <span class="inline2">infinity</span>), however this conversion can be disabled by passing <span class="inline2">true</span> into the optional&nbsp;<span><span class="inline2">inhibit_string_convert</span> argument, meaning these will remain as strings.</span></li><li>See&nbsp;<a href="../../../../Additional_Information/Guide_To_Using_JSON.htm#data_conversions">Data Conversions</a>&nbsp;for a full overview.</li></ul></li><li>See&nbsp;<a href="../../../../Additional_Information/Guide_To_Using_JSON.htm">Guide To Using JSON</a>&nbsp;for more information on how&nbsp;<span data-keyref="GameMaker Name">GameMaker</span>&nbsp;interacts with the JSON format.</li></ul><div data-conref="../../../../assets/snippets/Note_See_Guide_To_Using_JSON.hts"><p class="note"><span data-conref="../../../../assets/snippets/Tag_note.hts"><span class="note">NOTE</span></span>&nbsp;See&nbsp;<a href="../../../../Additional_Information/Guide_To_Using_JSON.htm">Guide To Using JSON</a>&nbsp;for detailed information on how to work with JSON in&nbsp;<span data-keyref="GameMaker Name">GameMaker</span>.</p></div><div data-conref="../../../../assets/snippets/JSON_Filter_Function_Description.hts"><h3>Filter Function&nbsp;<span data-conref="../../../../assets/snippets/Tag_optional.hts"><span class="optional">OPTIONAL</span></span></h3><p>The function optionally takes a&nbsp;<span data-keyref="Type_Function"><a target="_blank" href="../../../GML_Overview/Script_Functions.htm">Function</a></span>, which runs once for each value in the structure, including all nested structs/arrays and all the values inside them.</p><p>It takes two arguments&nbsp;<span class="inline2">(key, value)</span> where <span class="inline2">key</span> is the struct key name (<span data-keyref="Type_String"><a target="_blank" href="../../../GML_Overview/Data_Types.htm">String</a></span>) or array index (<span data-keyref="Type_Real"><a target="_blank" href="../../../GML_Overview/Data_Types.htm">Real</a></span>), and <span class="inline2">value</span> is what's stored in that key/index.</p><p>The filter function must always return a value. It can return a new value, which replaces the key's value in the final converted format returned by&nbsp;<span class="inline3_func"><span data-field="title" data-format="lower-alpha">json_parse</span></span>. If no new value should be returned for a particular key, the function must return the original <span class="inline2">value</span>.</p><p class="note"><span data-conref="../../../../assets/snippets/Tag_note.hts"><span class="note">NOTE</span></span>&nbsp;When overriding a key's value in the filter function (using <a href="../../../GML_Overview/Language_Features/return.htm">return</a>), make sure you check its type first, as the filter function runs for the root structure and any nested structures as well, meaning accidentally overriding them will result in a broken final structure. See&nbsp;<strong>Example 3</strong> at the bottom.</p></div><p>&nbsp;</p><h4>Syntax:</h4><p class="code"><span data-field="title" data-format="default">json_parse</span>(json, [filter_func], [inhibit_string_convert])</p><table><tbody><tr><th>Argument</th><th>Type</th><th>Description</th></tr><tr><td>json</td><td><span data-keyref="Type_String"><a target="_blank" href="../../../GML_Overview/Data_Types.htm">String</a></span></td><td>The JSON string to parse</td></tr><tr><td>filter_func</td><td><span data-keyref="Type_Function"><a target="_blank" href="../../../GML_Overview/Script_Functions.htm">Function</a></span></td><td><span data-conref="../../../../assets/snippets/Tag_optional.hts"><span class="optional">OPTIONAL</span></span>&nbsp;Filter function that processes each item. Don't pass a value or set this to <span class="inline2">undefined</span> if you only want to set <span class="inline2">inhibit_string_convert</span>. Syntax:&nbsp;<span class="inline2">function(key, value) -&gt; new_value</span></td></tr><tr><td>inhibit_string_convert</td><td><span data-keyref="Type_Bool"><a target="_blank" href="../../../GML_Overview/Data_Types.htm">Boolean</a></span></td><td><span data-conref="../../../../assets/snippets/Tag_optional.hts"><span class="optional">OPTIONAL</span></span>&nbsp;Set this to <span class="inline2">true</span> to disable converting strings into runtime references. Default value: <span class="inline2">false</span></td></tr></tbody></table><p>&nbsp;</p><h4>Returns:</h4><p class="code"><span data-keyref="Type_Struct"><a target="_blank" href="../../../GML_Overview/Structs.htm">Struct</a></span>&nbsp;or&nbsp;<span data-keyref="Type_Array"><a target="_blank" href="../../../GML_Overview/Arrays.htm">Array</a></span></p><p>&nbsp;</p><h4>Example 1:</h4><p class="code">var json = "{\"myObj\": { \"apples\":10, \"oranges\":12, \"potatoes\":100000, \"avocados\":0 }, \"myArray\":[0, 1, 2, 2, 4, 0, 1, 5, 1]}";<br><br>var data = json_parse(json);<br>show_debug_message(data);</p><p>The above code creates a new string containing valid JSON, and then calls&nbsp;<span class="inline3_func"><a href="json_parse.htm">json_parse</a></span> to convert that string into a GML struct. It then prints the result to the debug log.</p><p class="note"><span data-conref="../../../../assets/snippets/Tag_note.hts"><span class="note">NOTE</span></span>&nbsp;You will notice that the JSON string contains&nbsp;a backslash (<span class="inline2">\</span>) before every double quote (<span class="inline2">"</span>) inside it:<br><br><span class="inline2">json = "{&nbsp;<strong>\"&nbsp;</strong>myObj</span><br><br>This is to ensure that the double quote is read as an actual character within the string, instead of being read as part of the code and closing the string prematurely. This way we are using a backslash to "escape" the double quote.<br><br>If you are loading JSON from an external file however, there is no need to escape characters in that file.</p><hr><p>After parsing the JSON string above, if you know its structure, you can use various&nbsp;<a href="../../Variable_Functions/Variable_Functions.htm">Variable Functions</a> to check and read its contents:</p><p class="code">var data = json_parse(json);<br><br>// Check if the struct has myObj variable<br>if (variable_struct_exists(data, "myObj"))<br>{<br>&nbsp; &nbsp; // Check if it's a struct<br>&nbsp; &nbsp; if (is_struct(data.myObj))<br>&nbsp;&nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; // Print all struct members to the log<br>&nbsp; &nbsp; &nbsp; &nbsp; var _names = variable_struct_get_names(data.myObj);<br>&nbsp; &nbsp; &nbsp; &nbsp; var _str = "";<br>&nbsp; &nbsp; &nbsp; &nbsp; for (var i = 0; i &lt; array_length(_names); i++;)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;_str = _names[i] + ": " +&nbsp;string(variable_struct_get(data.myObj, _names[i]));<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; show_debug_message(_str);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp; &nbsp;}<br>}<br><br>// Check if the struct has myArray variable<br>if (variable_struct_exists(data, "myArray"))<br>{<br>&nbsp; &nbsp; // Check if it's an array<br>&nbsp; &nbsp; if (is_array(data.myArray))<br>&nbsp;&nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; show_debug_message(data.myArray);<br>&nbsp;&nbsp; &nbsp;}<br>}</p><p>The above code will parse the given&nbsp;JSON string, generating the following console output:</p><p class="code">oranges: 12<br>potatoes: 100000<br>avocados: 0<br>apples: 10<br>[ 0,1,2,2,4,0,1,5,1 ]</p><p>&nbsp;</p><h4>Example 2: Filter Function</h4><p class="code">var json = "{\"myObj\": { \"apples\":10, \"oranges\":12, \"potatoes\":100000, \"avocados\":0 }, \"myArray\":[0, 1, 2, 2, 4, 0, 1, 5, 1]}";<br><br>var data = json_parse(json, function (key, value)<br>{<br>&nbsp;&nbsp; &nbsp;show_debug_message($"Key: {key}, Value: {value}");<br>&nbsp; &nbsp; return value;<br>});</p><p>The above code takes the same JSON string from the previous example, and converts it into a GML struct, however this time it uses a filter function.</p><p>The filter function prints the key and value of each item to the Output Log:</p><p class="code_plain">Key: apples, Value: 10<br>Key: oranges, Value: 12<br>Key: potatoes, Value: 100000<br>Key: avocados, Value: 0<br>Key: myObj, Value: { apples : 10, oranges : 12, potatoes : 100000, avocados : 0 }<br>Key: 8, Value: 1<br>Key: 7, Value: 5<br>Key: 6, Value: 1<br>Key: 5, Value: 0<br>Key: 4, Value: 4<br>Key: 3, Value: 2<br>Key: 2, Value: 2<br>Key: 1, Value: 1<br>Key: 0, Value: 0<br>Key: myArray, Value: [ 0,1,2,2,4,0,1,5,1 ]<br>Key: , Value: { myObj : { apples : 10, oranges : 12, potatoes : 100000, avocados : 0 }, myArray : [ 0,1,2,2,4,0,1,5,1 ] }</p><p>Note how the filter function runs on the struct (<span class="inline2">myObj</span>) and array (<span class="inline2">myArray</span>) in the JSON and then also on each item inside the struct and array. It also runs on the root structure with the key set to an empty string (here, seen on the last line).</p><p>&nbsp;</p><h4>Example 3: Overriding Values</h4><p class="code">var json = "{\"prices\": [2, 5, 1, 2, 4, 5]}";<br><br>var data = json_parse(json, function (key, value)<br>{<br>&nbsp; &nbsp;&nbsp;return is_real(value) ? value * 1000 : value;<br>});<br><br>show_debug_message(data);</p><p>The above code takes a JSON string containing an array inside a struct. Then&nbsp;<span class="inline3_func"><span data-field="title" data-format="default">json_parse</span></span> is run with a filter function that multiplies each value with 1000, only when it's a <span data-keyref="Type_Real"><a target="_blank" href="../../../GML_Overview/Data_Types.htm">Real</a></span>. Otherwise it simply returns the value itself.</p><p>The resulting structure looks like this:</p><p class="code_plain">{ prices : [ 2000,5000,1000,2000,4000,5000 ] }</p><p>&nbsp;</p><p>&nbsp;</p><div class="footer"><div class="buttons"><div class="clear"><div style="float:left">Back: <a href="Encoding_And_Hashing.htm">File Encoding</a></div><div style="float:right">Next: <a href="base64_encode.htm">base64_encode</a></div></div></div><h5><span data-keyref="Copyright Notice">© Copyright YoYo Games Ltd. 2024 All Rights Reserved</span></h5></div></body></html>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><script type="text/javascript" src="../../../assets/import/jquery-3.6.1.min.js"></script><script type="text/javascript" src="../../../assets/import/layer/layer.js"></script><script type="text/javascript" src="../../../assets/import/pangu.min.js"></script><link rel="stylesheet" type="text/css" href="../../../assets/import/layer/layui_btn.css"><link rel="stylesheet" type="text/css" href="../../../assets/import/layer/layui_col.css"><link rel="stylesheet" type="text/css" href="../../../assets/import/layer/theme/default/layer.css"><link rel="stylesheet" type="text/css" href="../../../assets/import/main.css"><script>let str;removeHtml=function(t){return t=(t=(t=(t=t.replace(/(<([^>]+)>)/gi,"{}")).replace(/\r\n/g,"\n")).replace(/\n/g,"")).replace(/ {2,}/g," ")},retHtml=function(t){return t.match(/(<([^>]+)>)/gi)},setTranslator=function(t,n,a){let e;e=a?t.attr(a):t.html();let l=n[removeHtml(e)];if(null!=l&&l.length){n=retHtml(e);let o=0;n&&n.forEach(function(t,n){var a=l.replace("{"+o+"}",t);l=a===l?l.replace("{}",t):a,o++}),a?t.attr(a,l):t.html(l)}},noTranslationState=function(){return"true"==window.localStorage.getItem("noTranslationState")},noTranslationStateToggle=function(){window.localStorage.setItem("noTranslationState",!noTranslationState())},addNoTranslationStateButton=function(){$(".header").length&&$(".header").append(`
		
		<button style="
			float: right;
			font-size: 16px;
			padding: 4px 12px;
		"
		onclick="
		window.location.replace('gmmt://'+document.location.hash)
		"
		>打开编辑器</button>

		<button style="
			float: right;
			font-size: 16px;
			padding: 4px 12px;
		"
		onclick="
		noTranslationStateToggle();
		location.reload();
    	event.stopPropagation();
		"
		>切换翻译</button>
		`)},removeExtensionFromHash=function(t){return t.replaceAll("#t=","").replaceAll("%2F","/").replaceAll(".htm","")},$(function(){if(addNoTranslationStateButton(),noTranslationState())return!1;$("div.footer a,h4,caption").each(function(){setTranslator($(this),json_global)}),$("p,h1,h2,h3,td,li,a,div.dropspotnote,figcaption").each(function(){setTranslator($(this),json)}),$("th,.warning,.important,.optional").each(function(){setTranslator($(this),json_global)}),$(".header").length&&(window.setInterval(function(){$("#toc-panel a:not('isTranslate')").each(function(){$(this).addClass("isTranslate"),setTranslator($(this),json_global)}),$(".GlossDefinitionText:not('isTranslate')").each(function(){$(this).addClass("isTranslate"),setTranslator($(this),json_global)})},250),console.log("成功啦!现在正在疯狂翻译菜单中!")),$(".tooltip").each(function(){setTranslator($(this),json_global,"title")})}),document.addEventListener("DOMContentLoaded",()=>{pangu.autoSpacingPage()})</script><script type="text/javascript" language="JavaScript">function reDo(){innerWidth==origWidth&&innerHeight==origHeight||location.reload()}4==parseInt(navigator.appVersion)&&"Netscape"==navigator.appName&&(origWidth=innerWidth,origHeight=innerHeight,onresize=reDo),onerror=null</script><style type="text/css">p.WebHelpNavBar{text-align:right}</style><script type="text/javascript">gCommonRootRelPath=gRootRelPath="../../..",gTopicId="8.2.1.3.0_9"</script><script type="text/javascript" src="../../../template/scripts/rh.min.js"></script><script type="text/javascript" src="../../../template/scripts/common.min.js"></script><script type="text/javascript" src="../../../template/scripts/topic.min.js"></script><script type="text/javascript" src="../../../template/scripts/topicwidgets.min.js"></script><script type="text/javascript" src="../../../whxdata/projectsettings.js"></script><link rel="stylesheet" type="text/css" href="../../../template/styles/topic.min.css"><link rel="stylesheet" type="text/css" href="../../../template/Charcoal_Grey/topicheader.css"><meta name="topic-status" content="Draft"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>with</title><meta name="generator" content="Adobe RoboHelp 2022"><link rel="stylesheet" href="../../../assets/css/default.css" type="text/css"><script src="../../../assets/scripts/main_script.js" type="module"></script><meta name="rh-authors" content="Mark Alexander"><meta name="topic-comment" content="Page outlining the with function"><meta name="rh-index-keywords" content="with"><meta name="search-keywords" content="with"><meta name="brsnext" value="GameMaker_Language/GML_Overview/Language_Features/return.htm"><meta name="brsprev" value="GameMaker_Language/GML_Overview/Language_Features/exit.htm"></head><body><div class="topic-header rh-hide" id="rh-topic-header"><div class="logo"></div><div class="nav"><div class="title" title="with"><span>with</span></div><div class="gotohome" title="Click here to see this page in full context"><a href="#" onclick="rh._.goToFullLayout()">Click here to see this page in full context</a></div></div></div><div class="topic-header-shadow rh-hide" id="rh-topic-header-shadow"></div><h1><span data-field="title" data-format="default">with</span></h1><p>As indicated in the section <a href="../Addressing_Variables_In_Other_Instances.htm">Addressing Variables in Other Instances</a>, it is possible to read and change the value of variables in instances and <a href="../Structs.htm">structs</a> other than the one currently executing any given code. However, in a number of cases you want to do a lot more than just change a single variable within those other instances, and may want to perform more complex code actions that require multiple functions and lines of code. For example, imagine that you want to move all the instances of a ball object in your game 8 pixels down. You may think that this is achieved simply by the following piece of code:</p><p class="code">obj_ball.y = obj_ball.y + 8;</p><p>But this is not correct, as the right-hand side of the assignment gets the value of the y-coordinate of the first ball and adds 8 to it. Next this new value is set as the y-coordinate of <em>all</em> balls, so the result is that all balls get the same y-coordinate, and even if you use the following:</p><p class="code">obj_ball.y += 8;</p><p>it will have exactly the same effect because it is simply an abbreviation of the first statement. So how <i>do</i> we achieve something like this? This is why the&nbsp;<span class="inline2"><span data-field="title" data-format="default">with</span></span> statement exists in GML.</p><h2 id="syntax">Syntax</h2><p>The <span class="inline2"><span data-field="title" data-format="default">with</span></span> statement takes the form:</p><p class="code"><span data-field="title" data-format="default">with</span>&nbsp;(&lt;expression&gt;)<br>{<br>&nbsp; &nbsp; &lt;statement&gt;;<br>&nbsp; &nbsp; &lt;statement&gt;;<br>&nbsp; &nbsp; ...<br>}</p><p>The <a class="tooltip" title="An expression is a combination of one or more constants, variables, operators, and/or functions that are interpreted according to particular rules of precedence and association to return another value. A simple expression would be (5 + 5), which returns 10.">expression</a>&nbsp;can take a number of different inputs:</p><ul class="colour"><li>One or more instances to perform the code on: a single <span data-keyref="Type_ID_Instance"><a target="_blank" href="../../GML_Reference/Asset_Management/Instances/Instance_Variables/id.htm">Object Instance</a></span>, an&nbsp;<span data-keyref="Type_Asset_Object"><a target="_blank" href="../../../The_Asset_Editors/Objects.htm">Object Asset</a></span> (which indicates that&nbsp;<i>all instances</i>&nbsp;of this object in the room are to run the code block).</li><li>One or more structs, or the keyword <span class="inline2">global</span> to access the&nbsp;<a href="../Variables/Global_Variables.htm#the_global_struct">The Global Struct</a>.</li><li>One of the special&nbsp;<a href="../Instance_Keywords.htm">keywords</a>&nbsp;(<span class="inline2">self</span>, <span class="inline2">other</span>,&nbsp;<span class="inline2">all</span> or <span class="inline2">noone</span>).</li></ul><p>This will then change the&nbsp;<a href="../Variables_And_Variable_Scope.htm">scope</a> of the code within the curly brackets <span class="inline2">{ }</span> from the instance, struct or function that executes the&nbsp;<span class="inline2"><span data-field="title" data-format="default">with</span></span> to the instance (or instances or struct) given in the expression.</p><p>Once the expression has set the scope of the <span class="inline2">with</span>, the <a class="tooltip" title="In programming, a statement is a single line of code written legally in a programming language that expresses an action to be carried out. A statement might have internal components of its own, including expressions, operators and functions. An example of a statement is A = B + 5. A GameMaker Studio 2 program is nothing but a sequence of one or more statements that together perform a task (like move the player). ">statement</a> will then be executed for each of the indicated instances or structs, as if it is the current (i.e.&nbsp;<span class="inline2">self</span>). So, returning to our original problem, to move all instances of the ball object 8 pixels down you would type:</p><p class="code">with (obj_ball)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;y += 8;<br>}</p><hp></hp><p>If you want to execute multiple statements, just include them in the curly brackets, the same as you would around any other code block. So for example, to move all the balls in our example to a random position and give them a random speed and direction, you would use:</p><p class="code">with (obj_ball)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;x = random(room_width);<br>&nbsp;&nbsp;&nbsp;&nbsp;y = random(room_height);<br>&nbsp;&nbsp;&nbsp;&nbsp;speed = 1 + random(2);<br>&nbsp;&nbsp;&nbsp;&nbsp;direction = random(360);<br>}</p><p>&nbsp;</p><div data-conref="../../../assets/snippets/Instance_creation_order_warning.hts"><p class="note"><span class="note">NOTE</span>&nbsp;Instances in a room are created in a certain <a href="../../../The_Asset_Editors/Room_Properties/Room_Properties.htm#creation_order">order</a>, and their Create events are also executed as they are created one-by-one. This means that you must be careful when reading variables from other instances in the Create event, as that other instance may not have run its Create event yet!<br><br>For example: let's say <strong>ObjectA</strong> is created before <strong>ObjectB</strong>, and you have the following code in those objects' Create events:<br><br><strong>ObjectA</strong> Create -&nbsp;<span class="inline2">myValue = objectB.myValue;</span><br><strong>ObjectB</strong> Create -&nbsp;<span class="inline2">myValue = 10;</span><br><br>ObjectA is created first and its Create event runs, which then crashes the game:<br><br><em><strong>"Variable objectB.myValue(100003, -2147483648) not set before reading it."</strong></em><br><br>That's simply because ObjectB has not even been created yet, so any variables initialised in its Create event do not yet exist. This is why you must take caution when referencing other instances&nbsp;like this in the Create event, including any code run inside <span class="inline"><a href="with.htm">with()</a></span> blocks.</p></div><p>&nbsp;</p><h2 id="with_as_a_loop">With as a Loop</h2><p>The&nbsp;<span class="inline2"><span data-field="title" data-format="default">with</span></span>&nbsp;statement essentially performs a loop. Depending on the result of the expression, the statements inside the curly brackets <span class="inline2">{&nbsp;}</span> will either be not executed at all, executed a single time or multiple times:&nbsp;</p><ul class="colour"><li>When <span class="inline2">with</span> receives <span class="inline2">noone</span>, it executes 0 times, i.e. it runs the code for "no one".</li><li>When it receives an&nbsp;<span data-keyref="Type_ID_Instance"><a target="_blank" href="../../GML_Reference/Asset_Management/Instances/Instance_Variables/id.htm">Object Instance</a></span>, a&nbsp;<span data-keyref="Type_Struct"><a target="_blank" href="../Structs.htm">Struct</a></span> or one of the keywords <span class="inline2">self</span>,&nbsp;<span class="inline2">other</span>&nbsp;or <span class="inline2">global</span>, it runs the code once, for the instance or struct being referenced.</li><li>When it receives an&nbsp;<span data-keyref="Type_Asset_Object"><a target="_blank" href="../../../The_Asset_Editors/Objects.htm">Object Asset</a></span>&nbsp;or the keyword <span class="inline2">all</span>,&nbsp;it runs the code multiple times: every&nbsp;<a class="tooltip" title="An iteration is a single pass through a set of operations in your project code. One form of iteration in computer programming is via loops. A loop will repeat a certain segment of code until a condition is met and it can proceed further. Each time the computer runs a loop, it is known as an iteration. In simple terms, iteration is the process of repeating a particular snippet of code over and over again to perform a certain action.">iteration</a>&nbsp;of the loop will run on one instance of the object or on all instances, respectively.</li></ul><p>Because&nbsp;<span class="inline2"><span data-field="title" data-format="default">with</span></span>&nbsp;behaves as a loop, you can use the special <span class="inline2"><a href="break.htm">break</a></span> and <span class="inline2"><a href="continue.htm">continue</a></span> statements in it as well. Using <span class="inline2">break</span> will immediately exit the&nbsp;<span class="inline2"><span data-field="title" data-format="default">with</span></span> code block and move on to any code that is in the event or function after the <span class="inline2">with</span> should have finished, e.g.:</p><p class="code">var _count = 0;<br>with (obj_enemy)<br>{<br>&nbsp; &nbsp; if (++_count &gt; 10)<br>&nbsp; &nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>&nbsp; &nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;hp = 100;<br>}</p><p>The above code loops through the instances in the room of an object <span class="inline2">obj_enemy</span> and sets the variable <span class="inline2">hp</span> to 100 for the first 10 it finds. If any more than 10 instances exist, the with code will call <span class="inline2">break</span> and end.</p><p>An example of using <span class="inline2">continue</span> in a <span class="inline2">with</span>&nbsp;loop would be:</p><p class="code">with (obj_enemy_parent)<br>{<br>&nbsp; &nbsp; if (invulnerable == true)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; continue;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; hp -= 25;<br>}</p><p>This code will loop through all instances with the parent <span class="inline2">obj_enemy_parent</span>, then checks each instance to see if the <span class="inline2">invulnerable</span> instance variable is <span class="inline2">true</span> or not. If it is, the <span class="inline2">continue</span> keyword ends the current iteration of the loop and moves on to the next available instance, otherwise it removes 25 from the <span class="inline2">hp</span> variable. This will repeat until all instances with that parent have been checked.</p><h2 id="specific_uses">Specific Uses</h2><h3>The "other" Instance or Struct</h3><p>As mentioned above, within the statement(s), the indicated instance or struct&nbsp;has become the target (<span class="inline2">self</span>) instance that runs the code block, which means that the original instance (that contains the&nbsp;<span class="inline2"><span data-field="title" data-format="default">with</span></span> and the entire code block) has become the <a href="../Instance_Keywords.htm"><span class="inline">other</span></a> instance.</p><p>So - for example -&nbsp;to move all balls to the position of the current instance that actually contains the code, you can type this:</p><p class="code">with (obj_ball)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;x = other.x;<br>&nbsp;&nbsp;&nbsp;&nbsp;y = other.y;<br>}</p><h3>Executing Code in a New Instance</h3><p class="code">with (instance_create_layer(x, y, "Instances", obj_ball))<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;speed = other.speed;<br>&nbsp;&nbsp;&nbsp;&nbsp;direction = other.direction;<br>}</p><p>The above code will create an instance of <span class="inline2">obj_ball</span> and assign it the speed and direction of the instance that runs the whole code block.</p><p class="note"><span data-conref="../../../assets/snippets/Tag_tip.hts"><span class="tip">TIP</span></span>&nbsp;If you simply need to assign values to the new instance's variables, you can pass them through&nbsp;the<span class="inline2">var_struct</span> parameter of&nbsp;<span class="inline3_func"><a href="../../GML_Reference/Asset_Management/Instances/instance_create_layer.htm">instance_create_layer</a></span>&nbsp;/&nbsp;<span class="inline3_func"><a href="../../GML_Reference/Asset_Management/Instances/instance_create_depth.htm">instance_create_depth</a></span>.</p><h3>Instance Checking Functions</h3><p>Quite a few&nbsp;<a href="../../GML_Reference/Asset_Management/Instances/Instances.htm#general">instance functions</a>&nbsp;return either an <span data-keyref="Type_ID_Instance"><a target="_blank" href="../../GML_Reference/Asset_Management/Instances/Instance_Variables/id.htm">Object Instance</a></span>&nbsp;or <span class="inline2">noone</span>. This makes them convenient to use in combination with the <span class="inline2">with</span> statement:&nbsp;</p><p class="code">with (instance_nearest(x, y, obj_ball))<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;instance_destroy();<br>}</p><p>The above code will destroy the instance of <span class="inline2">obj_ball</span> nearest to the instance running the code.&nbsp;When no instance is found, the function returns <span class="inline2">noone</span>&nbsp;so that the code inside the&nbsp;<span class="inline2"><span data-field="title" data-format="default">with</span></span>&nbsp;isn't executed.</p><h3>Assigning Struct Variables</h3><p class="code">with(clone_struct)<br>{<br>&nbsp; &nbsp; xx&nbsp;= other.x;<br>&nbsp; &nbsp; yy = other.y;<br>&nbsp; &nbsp; spd = other.speed;<br>&nbsp; &nbsp; dir = other.direction;<br>}</p><p>The above code uses <span class="inline2">with</span> to target a struct and set the given struct member variables to the values stored in the instance variables from the instance calling the code.</p><h3>Local Variable to Cross Scopes</h3><p class="code">var _inst = noone;<br>with (obj_ball)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;if (str &gt; other.str)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp; _inst = id;<br>&nbsp; &nbsp; }<br>}<br>if (_inst != noone)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;target = _inst;<br>}</p><p>The above code is slightly more complex than previous ones due to it using a <a href="../Variables_And_Variable_Scope.htm">local variable</a>. This variable is <strong>local</strong> to either the <em>event</em>&nbsp;or the <em>script&nbsp;</em><em>function</em>&nbsp;and not to the instance or struct and so can be used and accessed by all instances that are referenced within the code block. So, in the code above we have set a local variable to the special&nbsp;keyword <span class="inline2">noone</span> and then use the <span class="inline2">with</span> construction to have every instance of&nbsp;<span class="inline2">obj_ball</span>&nbsp;check their&nbsp;<span class="inline2">str</span>&nbsp;variable against that of the instance running the code block. If the value of the variable is larger, then they store their unique ID in the&nbsp;<span class="inline2">inst</span>&nbsp;local variable, meaning that at the end of the code, only the instance with a value greater than the calling instance (or the&nbsp;keyword&nbsp;<span class="inline2">noone</span>&nbsp;if none are larger) will be stored in the local variable <span class="inline2">_inst</span>.</p><p>&nbsp;</p><p>&nbsp;</p><div class="footer"><div class="buttons"><div class="clear"><div style="float:left">Back: <a href="../Language_Features.htm">Language&nbsp;Features</a></div><div style="float:right">Next: <a href="return.htm">return</a></div></div></div><h5><span data-keyref="Copyright Notice">© Copyright YoYo Games Ltd. 2024 All Rights Reserved</span></h5></div><p>&nbsp;</p><p><br>&nbsp;</p><p>&nbsp;</p></body></html>
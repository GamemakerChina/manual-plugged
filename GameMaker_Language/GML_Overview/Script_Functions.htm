<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><script type="text/javascript" src="../../assets/import/jquery-3.6.1.min.js"></script><script type="text/javascript" src="../../assets/import/layer/layer.js"></script><script type="text/javascript" src="../../assets/import/pangu.min.js"></script><link rel="stylesheet" type="text/css" href="../../assets/import/layer/layui_btn.css"><link rel="stylesheet" type="text/css" href="../../assets/import/layer/layui_col.css"><link rel="stylesheet" type="text/css" href="../../assets/import/layer/theme/default/layer.css"><link rel="stylesheet" type="text/css" href="../../assets/import/main.css"><script>let str;removeHtml=function(t){return t=(t=(t=(t=t.replace(/(<([^>]+)>)/gi,"{}")).replace(/\r\n/g,"\n")).replace(/\n/g,"")).replace(/ {2,}/g," ")},retHtml=function(t){return t.match(/(<([^>]+)>)/gi)},setTranslator=function(t,n,a){let e;e=a?t.attr(a):t.html();let l=n[removeHtml(e)];if(null!=l&&l.length){n=retHtml(e);let o=0;n&&n.forEach(function(t,n){var a=l.replace("{"+o+"}",t);l=a===l?l.replace("{}",t):a,o++}),a?t.attr(a,l):t.html(l)}},noTranslationState=function(){return"true"==window.localStorage.getItem("noTranslationState")},noTranslationStateToggle=function(){window.localStorage.setItem("noTranslationState",!noTranslationState())},addNoTranslationStateButton=function(){$(".header").length&&$(".header").append(`
		
		<button style="
			float: right;
			font-size: 16px;
			padding: 4px 12px;
		"
		onclick="
		window.location.replace('gmmt://'+document.location.hash)
		"
		>打开编辑器</button>

		<button style="
			float: right;
			font-size: 16px;
			padding: 4px 12px;
		"
		onclick="
		noTranslationStateToggle();
		location.reload();
    	event.stopPropagation();
		"
		>切换翻译</button>
		`)},removeExtensionFromHash=function(t){return t.replaceAll("#t=","").replaceAll("%2F","/").replaceAll(".htm","")},$(function(){if(addNoTranslationStateButton(),noTranslationState())return!1;$("div.footer a,h4,caption").each(function(){setTranslator($(this),json_global)}),$("p,h1,h2,h3,td,li,a,div.dropspotnote,figcaption").each(function(){setTranslator($(this),json)}),$("th,.warning,.important,.optional").each(function(){setTranslator($(this),json_global)}),$(".header").length&&(window.setInterval(function(){$("#toc-panel a:not('isTranslate')").each(function(){$(this).addClass("isTranslate"),setTranslator($(this),json_global)}),$(".GlossDefinitionText:not('isTranslate')").each(function(){$(this).addClass("isTranslate"),setTranslator($(this),json_global)})},250),console.log("成功啦!现在正在疯狂翻译菜单中!")),$(".tooltip").each(function(){setTranslator($(this),json_global,"title")})}),document.addEventListener("DOMContentLoaded",()=>{pangu.autoSpacingPage()})</script><script type="text/javascript" language="JavaScript">function reDo(){innerWidth==origWidth&&innerHeight==origHeight||location.reload()}4==parseInt(navigator.appVersion)&&"Netscape"==navigator.appName&&(origWidth=innerWidth,origHeight=innerHeight,onresize=reDo),onerror=null</script><style type="text/css">p.WebHelpNavBar{text-align:right}</style><script type="text/javascript">gCommonRootRelPath=gRootRelPath="../..",gTopicId="8.2.1.1_5"</script><script type="text/javascript" src="../../template/scripts/rh.min.js"></script><script type="text/javascript" src="../../template/scripts/common.min.js"></script><script type="text/javascript" src="../../template/scripts/topic.min.js"></script><script type="text/javascript" src="../../template/scripts/topicwidgets.min.js"></script><script type="text/javascript" src="../../whxdata/projectsettings.js"></script><link rel="stylesheet" type="text/css" href="../../template/styles/topic.min.css"><link rel="stylesheet" type="text/css" href="../../template/Charcoal_Grey/topicheader.css"><meta name="topic-status" content="Draft"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Script Functions And Variables</title><meta name="generator" content="Adobe RoboHelp 2022"><link rel="stylesheet" href="../../assets/css/default.css" type="text/css"><script src="../../assets/scripts/main_script.js" type="module"></script><meta name="rh-authors" content="Gurpreet S. Matharoo"><meta name="topic-comment" content="Page outlining the use of scripts to create functions and global variables and macros"><meta name="rh-index-keywords" content="Script Functions And Variables"><meta name="search-keywords" content="user defined functions,script functions,gmcallback_,gmcallback"><meta name="brsnext" value="GameMaker_Language/GML_Overview/Method_Variables.htm"><meta name="brsprev" value="GameMaker_Language/GML_Overview/Expressions_And_Operators.htm"></head><body><div class="topic-header rh-hide" id="rh-topic-header"><div class="logo"></div><div class="nav"><div class="title" title="Script Functions And Variables"><span>Script Functions And Variables</span></div><div class="gotohome" title="Click here to see this page in full context"><a href="#" onclick="rh._.goToFullLayout()">Click here to see this page in full context</a></div></div></div><div class="topic-header-shadow rh-hide" id="rh-topic-header-shadow"></div><h1>Script Functions And Variables</h1><p>Script assets&nbsp;are essentially a collection of one or more user defined functions or variables that you write yourself as snippets of code in the <a href="../../The_Asset_Editors/Scripts.htm">Script Editor</a>. The functions you define in a script can resolve expressions, return values or do anything else that the GameMaker Language permits, just like the built in <a href="Runtime_Functions.htm">runtime functions</a>.</p><p>Script functions&nbsp;should generally be used if you have a block of code that you use in more than one place or object, or when you want a block of code to be used across multiple objects in a modular fashion. Using scripts to define functions means that you can change the function just once when required and the change will be "picked up" by every object that has a call to the function.</p><p>Scripts can also be very handy from an organisational point of view, as they permit you to create groups of functions that belong to a certain category - for example, you might have several functions all related to collisions between instances in your game, so you would create a "<span class="inline">Collision_Functions</span>" script and store all these functions together in it.</p><p>Also see:&nbsp;<a href="Script_Functions_vs_Methods.htm">Script Functions vs. Methods</a></p><h2>Creating Functions</h2><p>When creating a script with functions in it, the functions must be created using the following formats:</p><p class="code"><span>function name( parameter1, parameter2, ... )<br>{</span><br><span>&nbsp; &nbsp; statement1;</span><br><span>&nbsp; &nbsp; statement2;</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;...</span><br><span>}</span></p><p>or:</p><p class="code">name =&nbsp;function( parameter1, parameter2, ... )<br><span>{</span><br><span>&nbsp; &nbsp; statement1;</span><br><span>&nbsp; &nbsp; statement2;</span><br><span>&nbsp;&nbsp;&nbsp;&nbsp;...</span><br><span>}</span></p><p class="note">To create a function in GML Visual, use&nbsp;<a href="../../Drag_And_Drop/Drag_And_Drop_Reference/Common/Declare_A_New_Function.htm">Declare A New Function</a>. Enable its "Temp" option to create a method variable (second syntax shown above).</p><p>In general, however, you would use the <em>first</em> form for script functions as it will define the function as specifically being a script function, meaning that it will be <strong>global</strong> in <a href="Variables_And_Variable_Scope.htm">scope</a>, be assigned a <strong>script index</strong>, and not require the <span class="inline">global</span> prefix to identify it since the compiler will recognise it as a script function.</p><p>Using the second form will instead be generating a global scope <a href="Method_Variables.htm">method variable</a>, and as such it will <em>not</em> be recognised as a script function by the IDE and will require the use of the <span class="inline">global</span> prefix when being referenced&nbsp;in your code.</p><p class="note"><span class="note">NOTE</span>&nbsp;You can check this by using both forms in a script and then calling the runtime&nbsp;function <a href="../GML_Reference/Variable_Functions/typeof.htm">typeof()</a> on each of them. One will be classed as a "number" - since it returns a script index ID - and the other will be classed as a "method".</p><h2>Parameters/Arguments</h2><p>You can define your own parameters/arguments for a function, which will be available to the function as local variables and can be used for any purpose within that function:</p><p class="code">function move(<strong>spd, dir</strong>)<br>{<br>&nbsp;&nbsp; &nbsp;speed = <strong>spd</strong>;<br>&nbsp;&nbsp; &nbsp;direction = <strong>dir</strong>;<br>}</p><p>This function takes two arguments and applies their values to the instance's <span class="inline">speed</span> and <span class="inline">direction</span> variables. It can now be called like any runtime function and arguments can be passed into it:</p><p class="code">var _mouse_dir = point_direction(x, y, mouse_x, mouse_y);<br><br><strong>move(4, _mouse_dir);</strong></p><h2>Index-Based Arguments</h2><p>Arguments passed into a function can also be accessed through the <span class="inline">argumentN</span> variables (<em>argument0, argument1, etc.</em>) or the <a href="Variables/Builtin_Global_Variables/argument.htm"><span class="inline">argument[]</span></a> array (<em>argument[0], argument[1], etc.</em>).</p><p>You can get the number of arguments passed into the function using <a href="Variables/Builtin_Global_Variables/argument_count.htm"><span class="inline">argument_count</span></a>, thus allowing a variable number of arguments to be passed in.</p><p class="code">function print(){<br>&nbsp;&nbsp; &nbsp;var _str = "";<br><br>&nbsp;&nbsp; &nbsp;for (var i = 0; i &lt; argument_count; i ++)<br>&nbsp;&nbsp; &nbsp;{<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;_str += string(argument[i]);<br>&nbsp;&nbsp; &nbsp;}<br><br>&nbsp;&nbsp; &nbsp;show_debug_message(_str);<br>}<br><br>// In an object<br>print("Player : ", current_time, " : ", id, " : fired");</p><p>This <span class="inline2">print()</span> function loops through all the passed arguments, and adds them to a string variable. That string is then printed to the output log.</p><p>You can now call this function with as many strings as you like, which will all be joined together.</p><h2>Optional Arguments</h2><p>If an argument is not given to a function, its value will be&nbsp;<span class="inline">undefined</span>. You can use this to define&nbsp;<em>optional</em>&nbsp;arguments, and check whether an argument is passed in or not by checking if it is equal to <span class="inline">undefined</span>. However, you can also explicitly define a default value for an argument which will be used instead of <span class="inline">undefined</span>&nbsp;when it is not passed in.</p><p>You can assign such a default value to a parameter using the equal (<span class="inline">=</span>) sign, making it an optional variable:</p><p class="code">function move(spd, <strong>dir = 90</strong>)<br>{<br>&nbsp;&nbsp; &nbsp;speed = spd;<br>&nbsp;&nbsp; &nbsp;direction = dir;<br>}</p><p>If the <span class="inline">dir</span> argument is not passed in when calling the above function, then its value will default to <span class="inline">90</span>, moving the instance in an upward direction.</p><p class="note"><span class="tip">TIP</span>&nbsp;You can omit arguments from function calls and they will default to <span class="inline">undefined</span>&nbsp;(or the default value for that argument as defined by the function).<br><br>For example, writing&nbsp;<span class="inline">my_func(0,,,1)</span> is the same as writing&nbsp;<span class="inline">my_func(0, undefined, undefined, 1)</span>.</p><hr><p>The default&nbsp;value of an optional variable can be an&nbsp;expression, so for example, you can use variables and call functions while defining an optional variable. Note that such an expression will only be executed&nbsp;if its&nbsp;optional argument is not provided in the function call. See the following example of a logging function:</p><p class="code">function log(text = "Log", object = object_index, time = date_datetime_string(date_current_datetime()))<br>{<br>&nbsp;&nbsp; &nbsp;var _string = "[" + string(time) + "] ";<br>&nbsp;&nbsp; &nbsp;_string += object_get_name(object) + ": ";<br>&nbsp;&nbsp; &nbsp;_string += text;<br>&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp; &nbsp;show_debug_message(_string);<br>}</p><p>This function takes three arguments, where the&nbsp;first argument defaults to a string constant,&nbsp;the second argument defaults to an instance variable (in the scope of the calling instance) and the third argument defaults to an expression calling a function to retrieve the current date and time. This function can now be called with up to three&nbsp;arguments,&nbsp;as seen in the following example:</p><p class="code">log();<br>// Prints:&nbsp;[09-Jun-21 12:34:37 PM] Object1: Log<br><br>log("Player Shot", obj_player, 10);<br>// Prints:&nbsp;[10] obj_player: Player Shot</p><h2>JSDoc</h2><p>We also recommend that you add comments to define the properties of the function (see the section on <a href="../../The_Asset_Editors/Code_Editor_Properties/JSDoc_Script_Comments.htm">JSDoc Comments</a> for more details), such that a simple script would look like this:</p><p class="code">/// @function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;log(message);<br>/// @param {string}&nbsp; message&nbsp;&nbsp;The message to show<br>/// @description&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Show a message whenever the function is called.<br><br>function log(message)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;show_debug_message(message);<br>}</p><p>Additional functions for the script can be added using the same format as shown above, one after the other within the script asset.</p><p><img alt="Multiple Functions In One Script" class="center" src="../../assets/Images/Scripting_Reference/GML/Overview/Multiple_Functions_Scripts.png"></p><h2>Return Value</h2><p>Functions in scripts can also return a value, just as runtime functions can, and as such they can be used in expressions. For this you would use the <a href="Language_Features/return.htm"><span class="inline">return</span></a> statement:</p><p class="code">return &lt;expression&gt;</p><p>It should be noted that the <strong><i>execution of the function ends at the return statement</i></strong>, meaning that any code which comes after <strong>return</strong> has been called <i>will not be run</i>. Here is a short example function from a function called "<span class="inline">sqr_calc</span>" which calculates the square of whatever value is passed to it, and in case the given value is not a real number, it uses <strong>return</strong> to end the function early so the actual calculation never runs:</p><p class="code">/// @function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sqr_calc(val);<br>/// @param {real}&nbsp;&nbsp;val &nbsp;The value to calculate the square of<br>/// @description&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Calculate the square of the given value<br><br>function sqr_calc(val)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;if (!is_real(val))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;return (val&nbsp;* val);<br>}</p><p>Note that if you create a script function with&nbsp;<em>no</em>&nbsp;return value then in your code check for one, you will get the value <span class="inline">undefined</span>&nbsp;by default.</p><p>To call a script function from within a piece of code, just use it the same way as when calling any runtime function - that is, write the function name with the parameter values in parentheses. So, the above script would be called like this:</p><p class="code">if (keyboard_check_pressed(vk_enter))<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;val = scr_sqr(amount);<br>}</p><p class="note"><span data-conref="../../assets/snippets/Tag_note.hts"><span class="note">NOTE</span></span>&nbsp;When using your own functions from scripts in the code editor, you can press<span>&nbsp;<img alt="F1 Icon" class="icon" height="20" src="../../assets/Images/Icons/Icon_f1.png" width="55"></span>or click the middle mouse button <span><img alt="MMB Icon" class="icon" src="../../assets/Images/Icons/Icon_MMB.png">&nbsp;</span>on the function name to open the script that contains it for editing directly.</p><h2>Script Names vs. Function Names</h2><p>It is important to understand that script <i>names</i> are <b>independent of the functions that they contain</b>, so you can name your scripts in a more "common sense" way, i.e.: all your AI functions could go in a script "<span class="inline">Enemy_AI</span>" and contain functions like <span class="inline2">ai_target_pos()</span>, <span class="inline2">ai_alert_level()</span>, <span class="inline2">ai_state()</span>, etc.</p><p>However, you can still name a script the same as a function that you define in it and call the script, e.g. if you want one function per script (which can be useful for making reusable libraries so all functions are shown in the Asset Browser). When doing this, it is important to understand how script references behave to avoid code errors, due to the way <span data-keyref="GameMaker Name">GameMaker</span> stores asset references.</p><p>For example, consider this code, called from an instance's event:</p><p class="code">function indirectCall(func, arg)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;func(arg);<br>}<br><br>indirectCall(myscript, arg);</p><p>The above code is attempting to call a script called <span class="inline2">myscript</span>&nbsp;within a method, which in this case will fail. This is because the inline function is actually using the <em>index</em> for the script asset and <strong>not</strong> actually calling the script function - e.g.: if the script index resolves to "4", essentially the function is calling <span class="inline2">4(arg)</span>, which makes no sense.</p><p>Here are two things you can do to work around this:</p><ol><li>Convert the script index into a <a href="../GML_Reference/Variable_Functions/method.htm">method</a> before passing it as an argument</li><li>Use&nbsp;<span class="inline3_func"><a href="../GML_Reference/Asset_Management/Scripts/script_execute.htm">script_execute</a></span>&nbsp;to call the passed script reference</li></ol><p>Both ways are shown below:</p><p class="code">// 1<br>function indirectCall(func, arg)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;func(arg);<br>}<br><br>indirectCall(method(undefined, myscript), arg);<br><br>// 2<br>function indirectCall(func, arg)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;script_execute(func, arg);<br>}<br><br>indirectCall(myscript, arg);</p><div data-conref="../../assets/snippets/Script_empty_reference_error.hts"><p class="note"><span class="note">NOTE</span>&nbsp;Keep in mind that if your script is <strong>completely empty</strong>, it will not be loaded into the compiled game and will become non-existent; meaning that trying to reference such a script asset will crash your game. Note that this only applies to scripts that are completely empty, so even if your script only contains&nbsp;comments, it will still be included in the compiled game.</p></div><h2>Script Scope</h2><p>This leads us to the final and most important thing to know about scripts and the functions they contain: scripts are parsed on a <b>global</b> level and will be <strong>compiled at the very start of the game</strong>. This means that <em>technically</em> all functions in a script are "unbound"&nbsp;<a href="Method_Variables.htm">method variables</a>, and any variables declared outside of a function in the script will be considered <a href="Variables/Global_Variables.htm">global variables</a>. For example, consider this script:</p><p class="code">function Foo()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;// Do something<br>}<br>blah = 10;<br>function Bar()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;// Do something else<br>}</p><p>In the above case, not only have we defined the functions <span class="inline">Foo</span> and <span class="inline">Bar</span> but also the variable <span class="inline">blah</span> and all of them are considered to have been created in the <b>global</b> scope. The functions don't need the <span class="inline">global</span> keyword to be recognized as the compiler understands that these functions are part of the script, but if you wanted to access <span class="inline">blah</span> then you would need to do:</p><p class="code">val = global.blah;</p><p>That said, we recommend that you <b>always explicitly type global variables</b> when creating them in scripts to prevent any issues later. Scripts are also an ideal place to define any <strong>Macros</strong> or <strong>Enums</strong> (<a href="Variables/Constants.htm">constants</a>), as adding them to a script outside of a function also means that they will be created for use before the game code actually starts running. Below is an example of a script that is creating different global scope values for a game:</p><p class="code">/// Initialise All Global Scope Values And Constants<br>global.player_score = 0;<br>global.player_hp = 100;<br>global.pause = false;<br>global.music = true;<br>global.sound = true;<br><br>enum rainbowcolors<br>{<br>&nbsp; &nbsp; red,<br>&nbsp; &nbsp; orange,<br>&nbsp; &nbsp; yellow,<br>&nbsp; &nbsp; green,<br>&nbsp; &nbsp; blue,<br>&nbsp; &nbsp; indigo,<br>&nbsp; &nbsp; violet<br>}<br><br>#macro weapon_num&nbsp;3<br>#macro weapon_gun&nbsp;0<br>#macro weapon_bomb&nbsp;1<br>#macro weapon_knife 2</p><p>Note how all these constants are set up outside of any&nbsp;function call, meaning they will be initialised before everything else and at a <em>global</em> scope. This means that if you want to use a script&nbsp;to initialise variables on an <em>instance</em> scope then you must wrap them in a function, for example:</p><p class="code">/// @function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;init_enemy();<br>/// @description&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Initialise enemy instance vars<br><br>function init_enemy()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;hp = 100;<br>&nbsp;&nbsp;&nbsp;&nbsp;dmg = 5;<br>&nbsp;&nbsp;&nbsp;&nbsp;mana = 50;<br>}</p><p>So, scripts can be used to generate macros, enums and global variables before the game starts so they are ready for use at any time, and they can also be used to create "unbound" methods (user-defined functions) that can be used in your game like GML runtime functions.</p><p>One final thing to note about script functions is that if you are developing for <strong>Web</strong> (ie: targeting <strong>HTML5</strong>), then there is an additional function protocol that you can use when adding functions to scripts, which is to prefix a function name with <span class="inline">gmcallback_</span>, for example:</p><p class="code">gmcallback_create_button</p><p>Using the above function name would mean that the function <span class="inline">gmcallback_create_button()</span> will not be obfuscated and so can be used in JavaScript extensions and other areas of your game, for example, when using the <a href="../GML_Reference/Web_And_HTML5/Web_And_HTML5.htm"><span class="inline">clickable_*</span></a>&nbsp;functions.</p><h2>Static Variables</h2><p>Functions can also make use of static variables, which maintain their values throughout every function call. Please <a href="Functions/Static_Variables.htm">read this page</a> for more information.</p><p>&nbsp;</p><p>&nbsp;</p><div class="footer"><div class="buttons"><div class="clear"><div style="float:left">Back: <a href="GML_Overview.htm">GML&nbsp;Overview</a></div><div style="float:right">Next: <a href="Method_Variables.htm">Method Variables</a></div></div></div><h5><span data-keyref="Copyright Notice">© Copyright YoYo Games Ltd. 2024 All Rights Reserved</span></h5></div></body></html>